<section id="showroom" class="py-12 mt-20 bg-gray-50 font-sans text-gray-900 min-h-screen">
  <div class="max-w-[1400px] mx-auto px-4 sm:px-6 lg:px-8">
    <!-- Header da Página -->
    <div class="mb-8 border-b border-gray-200 pb-4">
      <h2 class="text-3xl font-black text-gray-900 tracking-tight">Estoque de Seminovos</h2>
      <p class="text-gray-500 mt-1">Encontre o carro ideal para você entre nossas ofertas.</p>
    </div>

    <div class="flex flex-col lg:flex-row gap-8 items-start">
      <!-- ASIDE: Filtros Laterais -->
      <aside class="w-full lg:w-72 flex-shrink-0">
        <div
          class="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 lg:sticky lg:top-24 max-h-[85vh] overflow-y-auto custom-scrollbar"
        >
          <div class="flex items-center justify-between mb-6 pb-4 border-b border-gray-100">
            <h3 class="font-bold text-gray-800 flex items-center gap-2">
              <i data-lucide="filter" class="w-4 h-4"></i> Filtros
            </h3>
            <button
              (click)="resetFilters()"
              class="text-xs text-red-600 font-bold hover:underline uppercase tracking-wide"
            >
              Limpar
            </button>
          </div>

          <!-- Filtro: Marca -->
          <div class="mb-6">
            <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Marca</h4>
            <div class="space-y-2">
              <label
                *ngFor="let brand of uniqueBrands"
                class="flex items-center gap-3 cursor-pointer group"
              >
                <input
                  type="checkbox"
                  [checked]="filters.brands[brand]"
                  (change)="toggleFilter('brands', brand)"
                  class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500 transition-all cursor-pointer"
                />
                <span
                  class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors font-medium"
                  >{{ brand }}</span
                >
              </label>
            </div>
          </div>

          <!-- Filtro: Preço -->
          <div class="mb-6">
            <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
              Preço (R$)
            </h4>
            <div class="flex gap-2 items-center">
              <input
                type="number"
                [(ngModel)]="filters.price.min"
                (ngModelChange)="onFilterChange()"
                placeholder="Mínimo"
                class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-colors appearance-none"
              />
              <span class="text-gray-400">-</span>
              <input
                type="number"
                [(ngModel)]="filters.price.max"
                (ngModelChange)="onFilterChange()"
                placeholder="Máximo"
                class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-colors appearance-none"
              />
            </div>
          </div>

          <!-- Filtro: Ano -->
          <div class="mb-6">
            <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Ano</h4>
            <div class="flex gap-2 items-center">
              <input
                type="number"
                [(ngModel)]="filters.year.min"
                (ngModelChange)="onFilterChange()"
                placeholder="De"
                class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-colors appearance-none"
              />
              <span class="text-gray-400">-</span>
              <input
                type="number"
                [(ngModel)]="filters.year.max"
                (ngModelChange)="onFilterChange()"
                placeholder="Até"
                class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-colors appearance-none"
              />
            </div>
          </div>

          <!-- Filtro: Km -->
          <div class="mb-6">
            <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
              Quilometragem
            </h4>
            <div class="flex gap-2 items-center">
              <input
                type="number"
                [(ngModel)]="filters.mileage.min"
                (ngModelChange)="onFilterChange()"
                placeholder="De"
                class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-colors appearance-none"
              />
              <span class="text-gray-400">-</span>
              <input
                type="number"
                [(ngModel)]="filters.mileage.max"
                (ngModelChange)="onFilterChange()"
                placeholder="Até"
                class="w-full bg-gray-50 border border-gray-200 rounded-lg px-3 py-2 text-sm focus:outline-none focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-colors appearance-none"
              />
            </div>
          </div>

          <!-- Filtro: Carroceria -->
          <div class="mb-6">
            <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">
              Carroceria
            </h4>
            <div class="space-y-2">
              <label
                *ngFor="let type of uniqueBodyTypes"
                class="flex items-center gap-3 cursor-pointer group"
              >
                <input
                  type="checkbox"
                  [checked]="filters.bodyTypes[type]"
                  (change)="toggleFilter('bodyTypes', type)"
                  class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500 transition-all cursor-pointer"
                />
                <span
                  class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors font-medium"
                  >{{ type }}</span
                >
              </label>
            </div>
          </div>

          <!-- Filtro: Cor -->
          <div class="mb-6">
            <h4 class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-3">Cor</h4>
            <div class="space-y-2">
              <label
                *ngFor="let color of uniqueColors"
                class="flex items-center gap-3 cursor-pointer group"
              >
                <input
                  type="checkbox"
                  [checked]="filters.colors[color]"
                  (change)="toggleFilter('colors', color)"
                  class="w-4 h-4 rounded border-gray-300 text-red-600 focus:ring-red-500 transition-all cursor-pointer"
                />
                <span
                  class="text-sm text-gray-600 group-hover:text-gray-900 transition-colors font-medium"
                  >{{ color }}</span
                >
              </label>
            </div>
          </div>
        </div>
      </aside>

      <!-- MAIN: Grid de Resultados -->
      <div class="flex-1 w-full" id="grid-top">
        <!-- Barra de Resultados -->
        <div
          class="flex flex-col sm:flex-row items-center justify-between mb-6 bg-white p-4 rounded-xl border border-gray-100 shadow-sm gap-4"
        >
          <span class="text-sm font-bold text-gray-600">
            Mostrando
            <span class="text-red-600 font-black text-lg">{{ filteredCars.length }}</span> veículos
            encontrados
          </span>

          <div class="flex items-center gap-2 w-full sm:w-auto">
            <span
              class="text-xs text-gray-400 font-bold uppercase hidden sm:inline whitespace-nowrap"
              >Ordenar por:</span
            >
            <select
              class="bg-gray-50 border-0 text-gray-700 text-sm font-bold py-2 pl-3 pr-8 rounded-lg focus:ring-2 focus:ring-red-500 cursor-pointer w-full sm:w-auto"
            >
              <option>Menor Preço</option>
              <option>Maior Preço</option>
              <option>Menor Km</option>
              <option>Mais Recentes</option>
            </select>
          </div>
        </div>

        <!-- Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6 min-h-[400px]">
          <div
            *ngFor="let car of paginatedCars"
            class="group bg-white rounded-2xl overflow-hidden border border-gray-100 shadow-sm hover:shadow-xl hover:border-red-100 transition-all duration-300 flex flex-col animate-fade-in relative"
          >
            <!-- Área de Mídia (Imagem ou 3D) - Altura Fixa -->
            <div class="relative h-56 bg-gray-100 w-full">
              <!-- VISUALIZAÇÃO 3D INTERATIVA (Ocupa exatamente o espaço h-56) -->
              <div
                *ngIf="car.is3DActive"
                class="w-full h-full bg-gray-100 animate-fade-in relative z-20"
              >
                <model-viewer
                  [src]="car.model3d"
                  alt="Visualização 3D"
                  camera-orbit="45deg 75deg 100%"
                  field-of-view="25deg"
                  auto-rotate
                  rotation-per-second="5deg"
                  camera-controls
                  disable-zoom
                  shadow-intensity="1"
                  class="w-full h-full focus:outline-none"
                  style="--poster-color: transparent; background-color: #f3f4f6"
                ></model-viewer>

                <!-- Botão Fechar 3D -->
                <button
                  (click)="toggle3D(car)"
                  class="absolute top-3 right-3 bg-white hover:bg-gray-50 text-gray-800 p-2 rounded-full shadow-lg border border-gray-100 transition-all z-30"
                  title="Voltar para fotos"
                >
                  <i data-lucide="x" class="w-4 h-4"></i>
                </button>

                <div
                  class="absolute bottom-3 left-1/2 -translate-x-1/2 bg-white/80 text-gray-800 text-[10px] font-bold px-3 py-1.5 rounded-full shadow-sm backdrop-blur pointer-events-none border border-gray-100"
                >
                  Modo Interativo
                </div>
              </div>

              <!-- VISUALIZAÇÃO DE IMAGEM PADRÃO -->
              <div
                *ngIf="!car.is3DActive"
                class="w-full h-full cursor-ew-resize relative z-10"
                (mousemove)="onMouseMove($event, car)"
                (mouseleave)="resetImage(car)"
              >
                <!-- Fallback Icon -->
                <div
                  *ngIf="car.imageLoadError"
                  class="absolute inset-0 flex flex-col items-center justify-center bg-gray-50 text-gray-300 z-10 pointer-events-none"
                >
                  <i data-lucide="car" class="w-12 h-12 mb-2 opacity-40"></i>
                  <span class="text-[10px] font-bold uppercase tracking-widest opacity-40"
                    >Sem Imagem</span
                  >
                </div>

                <img
                  *ngIf="!car.imageLoadError"
                  [src]="car.images[car.currentImageIndex]"
                  [alt]="car.model"
                  class="w-full h-full object-cover transition-none select-none"
                  draggable="false"
                  (error)="car.imageLoadError = true"
                />

                <div
                  *ngIf="car.badge"
                  class="absolute top-3 left-3 bg-red-600 text-white text-[10px] font-bold px-2 py-1 rounded shadow-sm uppercase tracking-wide z-20"
                >
                  {{ car.badge }}
                </div>

                <!-- BOTÃO ATIVAR 3D -->
                <button
                  *ngIf="car.model3d"
                  (click)="toggle3D(car)"
                  class="absolute top-3 right-3 bg-white hover:bg-red-600 hover:text-white text-gray-900 px-3 py-1.5 rounded-full shadow-md transition-all z-20 flex items-center gap-1.5 text-[10px] font-bold uppercase tracking-wide group/btn border border-gray-100"
                >
                  <i data-lucide="box" class="w-3.5 h-3.5"></i>
                  Ver 3D
                </button>

                <!-- Indicador Pseudo-360 -->
                <div
                  *ngIf="car.images.length > 1 && !car.imageLoadError && !car.model3d"
                  class="absolute top-3 right-3 bg-black/60 text-white p-1 rounded-full opacity-0 group-hover:opacity-100 transition-opacity z-20"
                >
                  <i data-lucide="rotate-3d" class="w-4 h-4"></i>
                </div>

                <div
                  class="absolute bottom-0 left-0 w-full h-20 bg-gradient-to-t from-black/70 to-transparent pointer-events-none z-10"
                ></div>

                <div class="absolute bottom-3 left-4 text-white pointer-events-none z-20">
                  <p class="text-xs font-bold opacity-90 border-l-2 border-red-500 pl-2">
                    {{ car.year }} • {{ car.color }}
                  </p>
                </div>
              </div>
            </div>

            <!-- Conteúdo do Card -->
            <div class="p-5 flex-1 flex flex-col bg-white relative z-10">
              <div class="mb-4">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-wider">{{
                  car.brand
                }}</span>
                <h3
                  class="text-lg font-extrabold text-gray-900 leading-tight line-clamp-1"
                  [title]="car.model"
                >
                  {{ car.model }}
                </h3>
                <p class="text-xs text-gray-500 mt-1">
                  {{ car.bodyType }} • {{ car.transmission }}
                </p>
              </div>

              <div class="flex items-center gap-4 mb-5 pb-4 border-b border-gray-50">
                <div class="flex items-center gap-1.5 text-gray-500" title="Quilometragem">
                  <i data-lucide="gauge" class="w-4 h-4 text-red-500"></i>
                  <span class="text-xs font-bold">{{ car.mileage / 1000 }}k km</span>
                </div>
                <div class="flex items-center gap-1.5 text-gray-500" title="Combustível">
                  <i data-lucide="fuel" class="w-4 h-4 text-red-500"></i>
                  <span class="text-xs font-bold">{{ car.fuel }}</span>
                </div>
              </div>

              <div class="mt-auto flex items-center justify-between">
                <div>
                  <p class="text-[10px] text-gray-400 uppercase font-bold tracking-wider mb-0.5">
                    À vista
                  </p>
                  <p class="text-2xl font-black text-gray-900 tracking-tight">
                    {{ formatPrice(car.price) }}
                  </p>
                </div>
                <button
                  class="w-10 h-10 rounded-xl bg-gray-900 text-white flex items-center justify-center hover:bg-red-600 transition-colors shadow-lg shadow-gray-200"
                >
                  <i data-lucide="arrow-right" class="w-5 h-5"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Estado Vazio -->
          <div
            *ngIf="paginatedCars.length === 0"
            class="col-span-1 md:col-span-2 xl:col-span-3 text-center py-16 bg-white rounded-2xl border border-dashed border-gray-300"
          >
            <div class="inline-flex p-4 bg-gray-50 rounded-full mb-4">
              <i data-lucide="search-x" class="w-8 h-8 text-gray-400"></i>
            </div>
            <h3 class="text-xl font-bold text-gray-900 mb-2">Nenhum veículo encontrado</h3>
            <p class="text-gray-500 text-sm mb-6">
              Tente ajustar os filtros laterais para encontrar o que procura.
            </p>
            <button (click)="resetFilters()" class="text-red-600 font-bold hover:underline text-sm">
              Limpar todos os filtros
            </button>
          </div>
        </div>

        <!-- PAGINAÇÃO -->
        <div class="mt-12 flex justify-center" *ngIf="totalPages > 1">
          <nav
            class="flex items-center gap-2 bg-white p-2 rounded-full shadow-sm border border-gray-100"
          >
            <!-- Botão Anterior -->
            <button
              (click)="changePage(currentPage - 1)"
              [disabled]="currentPage === 1"
              class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-gray-600"
            >
              <i data-lucide="chevron-left" class="w-5 h-5"></i>
            </button>

            <!-- Páginas -->
            <ng-container *ngFor="let page of getPageNumbers()">
              <button
                (click)="changePage(page)"
                class="w-10 h-10 flex items-center justify-center rounded-full text-sm font-bold transition-all"
                [ngClass]="
                  currentPage === page
                    ? 'bg-red-600 text-white shadow-md'
                    : 'text-gray-600 hover:bg-gray-100'
                "
              >
                {{ page }}
              </button>
            </ng-container>

            <!-- Botão Próximo -->
            <button
              (click)="changePage(currentPage + 1)"
              [disabled]="currentPage === totalPages"
              class="w-10 h-10 flex items-center justify-center rounded-full hover:bg-gray-100 disabled:opacity-50 disabled:cursor-not-allowed transition-colors text-gray-600"
            >
              <i data-lucide="chevron-right" class="w-5 h-5"></i>
            </button>
          </nav>
        </div>
      </div>
    </div>
  </div>
</section>
